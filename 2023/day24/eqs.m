% 19, 13, 30 @ -2,  1, -2
% 18, 19, 22 @ -1, -1, -2
% 20, 25, 34 @ -2, -2, -4
%[x1, y1, z1, vx1, vy1, vz1] = {19, 13, 30, -2,  1, -2}{:}
%[x2, y2, z2, vx2, vy2, vz2] = {18, 19, 22, -1, -1, -2}{:}
%[x3, y3, z3, vx3, vy3, vz3] = {20, 25, 34, -2, -2, -4}{:}

%233210433951170, 272655040388795, 179982504986147 @ 39, -98, 166
%385274025881243, 351578921558552, 375160114124378 @ -71, -36, -9
%298962016918939, 322446494312107, 293073189215975 @ 36, 8, 96


% 220824434287762, 25912163965555, 46272290905758 @ 105, 416, 421
% 328250628245255, 206059181314970, 421991677850024 @ -134, 108, -324
% 318571081875635, 210542087415780, 503574925874530 @ -38, 116, -281
% 191806143345159, 326028987539124, 309381155794042 @ 153, -88, -23
% 384690549589466, 232452348649319, 511439032229471 @ -179, 72, -372
% 198846084039554, 216265375378557, 225156974398801 @ 133, 34, -22
% 221105344157519, 241810380655562, 395248454330840 @ 26, -118, -882
% 262985831692337, 264306581492108, 233974019746148 @ -79, -115, -28
% 352980202408139, 481807077700748, 275698734979682 @ -52, -220, 91
% 245584314526803, 181910661443432, 188073598822350 @ 80, 159, 199
% 486424326428553, 478483299284374, 489268124278546 @ -331, -328, -307
% 249794844265187, 413492647270280, 434505095753282 @ 31, -333, -354
% 253138459784132, 433721962579099, 314039773803905 @ -29, -604, -246
% 185109670669244, 12706941956960, 43641783548659 @ 163, 423, 416
% 84607269180419, 31310497114262, 102095256416750 @ 352, 438, 339
% 57063184441840, 2848723329813, 179657077519134 @ 281, 332, 221

%[x1, y1, z1, vx1, vy1, vz1] = {233210433951170, 272655040388795, 179982504986147, 39, -98, 166}{:}
%[x2, y2, z2, vx2, vy2, vz2] = {385274025881243, 351578921558552, 375160114124378, -71, -36, -9}{:}
%[x3, y3, z3, vx3, vy3, vz3] = {298962016918939, 322446494312107, 293073189215975, 36, 8, 96}{:}

ignore_function_time_stamp
warning('off','all');

function newton_raphson(p1, p2, p3)

x1 = p1(1); y1 = p1(2); z1 = p1(3); vx1 = p1(4); vy1 = p1(5); vz1 = p1(6);
x2 = p2(1); y2 = p2(2); z2 = p2(3); vx2 = p2(4); vy2 = p2(5); vz2 = p2(6);
x3 = p3(1); y3 = p3(2); z3 = p3(3); vx3 = p3(4); vy3 = p3(5); vz3 = p3(6);

x=[ 	
	0;
	0;
	0;
	0;
	0;
	0;
	0;
	0;
	0
];


for i = 1:1000

% xk, yx, zk, vxk, vyk, vzk, t1, t2, t3 

xk = x(1);
yk = x(2);
zk = x(3);
vxk = x(4);
vyk = x(5);
vzk = x(6);
t1 = x(7);
t2 = x(8);
t3 = x(9);

B=[ 	
	(xk - x1) + (vxk - vx1) * t1;
	(yk - y1) + (vyk - vy1) * t1;
	(zk - z1) + (vzk - vz1) * t1;
	(xk - x2) + (vxk - vx2) * t2;
	(yk - y2) + (vyk - vy2) * t2;
	(zk - z2) + (vzk - vz2) * t2;
	(xk - x3) + (vxk - vx3) * t3;
	(yk - y3) + (vyk - vy3) * t3;
	(zk - z3) + (vzk - vz3) * t3;
];

A=[ 
	1, 0, 0, t1,  0,  0, (vxk - vx1),           0,           0;
	0, 1, 0,  0, t1,  0, (vyk - vy1),           0,           0;
	0, 0, 1,  0,  0, t1, (vzk - vz1),           0,           0;
	1, 0, 0, t2,  0,  0,           0, (vxk - vx2),           0;
	0, 1, 0,  0, t2,  0,           0, (vyk - vy2),           0;
	0, 0, 1,  0,  0, t2,           0, (vzk - vz2),           0;
	1, 0, 0, t3,  0,  0,           0,           0, (vxk - vx3);
	0, 1, 0,  0, t3,  0,           0,           0, (vyk - vy3);
	0, 0, 1,  0,  0, t3,           0,           0, (vzk - vz3);
];

DY = A \ B;

x = x - DY;
%disp(x)
if norm(B) < 1.0e-10
	norm(B)
	fprintf('result = %.0f norm = %.4f\n',x(1)+x(2)+x(3), norm(B))
	break
endif

endfor

endfunction


particles = [
 220824434287762, 25912163965555, 46272290905758 , 105, 416, 421;
 328250628245255, 206059181314970, 421991677850024 , -134, 108, -324;
 318571081875635, 210542087415780, 503574925874530 , -38, 116, -281;
 191806143345159, 326028987539124, 309381155794042 , 153, -88, -23;
 384690549589466, 232452348649319, 511439032229471 , -179, 72, -372;
 198846084039554, 216265375378557, 225156974398801 , 133, 34, -22;
 221105344157519, 241810380655562, 395248454330840 , 26, -118, -882;
 262985831692337, 264306581492108, 233974019746148 , -79, -115, -28;
 352980202408139, 481807077700748, 275698734979682 , -52, -220, 91;
 245584314526803, 181910661443432, 188073598822350 , 80, 159, 199;
 486424326428553, 478483299284374, 489268124278546 , -331, -328, -307;
 249794844265187, 413492647270280, 434505095753282 , 31, -333, -354;
 253138459784132, 433721962579099, 314039773803905 , -29, -604, -246;
 185109670669244, 12706941956960, 43641783548659 , 163, 423, 416;
 84607269180419, 31310497114262, 102095256416750 , 352, 438, 339;
 57063184441840, 2848723329813, 179657077519134 , 281, 332, 221;
];


np = size(particles)(1)
for i = 1:np-2
	for j = i+1:np-1
		for k = j+1:np
			newton_raphson(particles(i,:),particles(j,:),particles(k,:));
		endfor
	endfor
endfor



% 527310134398220 too low
% 527310134398252 too high
